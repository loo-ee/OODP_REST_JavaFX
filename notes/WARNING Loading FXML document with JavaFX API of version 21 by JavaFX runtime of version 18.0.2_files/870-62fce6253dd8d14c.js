"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[870],{79911:function(e,t){function r(e,t,r){if(void 0===r&&(r={}),!t.codes){t.codes={};for(var n,i=0;i<t.chars.length;++i)t.codes[t.chars[i]]=i}if(!r.loose&&e.length*t.bits&7)throw SyntaxError("Invalid padding");for(var o=e.length;"="===e[o-1];)if(--o,!r.loose&&!((e.length-o)*t.bits&7))throw SyntaxError("Invalid padding");for(var a=new(null!=(n=r.out)?n:Uint8Array)(o*t.bits/8|0),s=0,c=0,d=0,l=0;l<o;++l){var h=t.codes[e[l]];if(void 0===h)throw SyntaxError("Invalid character "+e[l]);c=c<<t.bits|h,(s+=t.bits)>=8&&(s-=8,a[d++]=255&c>>s)}if(s>=t.bits||255&c<<8-s)throw SyntaxError("Unexpected end of data");return a}function n(e,t,r){void 0===r&&(r={});for(var n=r.pad,i=(1<<t.bits)-1,o="",a=0,s=0,c=0;c<e.length;++c)for(s=s<<8|255&e[c],a+=8;a>t.bits;)a-=t.bits,o+=t.chars[i&s>>a];if(a&&(o+=t.chars[i&s<<t.bits-a]),void 0===n||n)for(;o.length*t.bits&7;)o+="=";return o}var i={chars:"0123456789ABCDEF",bits:4},o={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},a={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},s={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},c={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6};t.YU={parse:function(e,t){return r(e.toUpperCase(),i,t)},stringify:function(e,t){return n(e,i,t)}},t.pJ={parse:function(e,t){return void 0===t&&(t={}),r(t.loose?e.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):e,o,t)},stringify:function(e,t){return n(e,o,t)}},t.eV={parse:function(e,t){return r(e,a,t)},stringify:function(e,t){return n(e,a,t)}},t.US={parse:function(e,t){return r(e,s,t)},stringify:function(e,t){return n(e,s,t)}},t.tH={parse:function(e,t){return r(e,c,t)},stringify:function(e,t){return n(e,c,t)}},t.Y2={parse:r,stringify:n}},21870:function(e,t,r){r.d(t,{ZP:function(){return L}});var n=r(79911);n.YU,n.pJ,n.eV;let i=n.US;n.tH,n.Y2;class o{[Symbol.toStringTag]="[object EncoderMap]";encoder;constructor(e){this.encoder=new Map(e?Array.from(e,([e,t])=>[e.toString(),t]):void 0)}get size(){return this.encoder.size}clear(){this.encoder.clear()}delete(e){return this.encoder.delete(e.toString())}forEach(e){this.encoder.forEach((t,r)=>{e(t,new Uint8Array(r.split(",").map(Number)),this)})}get(e){return this.encoder.get(e.toString())}getOrThrow(e){let t=this.encoder.get(e.toString());if(void 0===t)throw Error(`The byte-pair encoding does not contain a value for: ${e.toString()}`);return t}has(e){return this.encoder.has(e.toString())}set(e,t){return this.encoder.set(e.toString(),t),this}*entries(){for(let[e,t]of this.encoder.entries())yield[new Uint8Array(e.split(",").map(Number)),t]}*keys(){for(let e of this.encoder.keys())yield new Uint8Array(e.split(",").map(Number))}values(){return this.encoder.values()}[Symbol.iterator](){return this.entries()}}var a=r(40025);function s(e){return e.replace(/[$()*+.?[\\\]^{|}]/g,"\\$&")}class c{encoder;decoder;tokenSplitRegex;specialTokensEncoder;specialTokensDecoder;specialTokenPatternRegex;textEncoder=new TextEncoder;constructor({bytePairEncoder:e,specialTokenEncoder:t,tokenSplitRegex:r}){this.encoder=e??new o,this.decoder=e?new Map([...e].map(([e,t])=>[t,e])):new Map,this.specialTokensEncoder=t??new Map,this.specialTokensDecoder=t?new Map([...t].map(([e,t])=>[t,this.textEncoder.encode(e)])):new Map,this.tokenSplitRegex=r;let n=[...this.specialTokensEncoder.keys()].map(s),i=n.join("|");try{this.specialTokenPatternRegex=RegExp(i)}catch{throw Error("Invalid regular expression pattern.")}}*encodeNative(e,t){let r=0,n=0;for(;;){let i=this.findNextSpecialStartIndex(e,t,r,this.specialTokenPatternRegex),o=void 0!==i?i:e.length,a=e.slice(r,o-r);for(let[e]of a.matchAll(this.tokenSplitRegex)){let t=this.textEncoder.encode(e),r=this.encoder.get(t);if(void 0!==r){n=1,yield[r];continue}let i=this.bytePairEncode(t,this.encoder);n=i.length,yield i}if(void 0!==i){let t=e.slice(Math.max(0,i)),o=this.specialTokensEncoder.get(t);if(void 0===o)throw Error(`Special token "${t}" is not in the special token encoder.`);yield[o],r=i+t.length,n=0}else break}return n}findNextSpecialStartIndex(e,t,r,n){let i=r;for(;;){let r=n.exec(e.slice(Math.max(0,i)));if(!r)return;let[o]=r;if(t.has(o))return r.index+i;i=r.index+i+1}}*decodeNative(e){for(let t of e){let e=this.tryDecodeToken(t);e&&(yield e)}}async*decodeNativeAsync(e){for await(let t of e){let e=this.tryDecodeToken(t);e&&(yield e)}}tryDecodeToken(e){return this.decoder.get(e)??this.specialTokensDecoder.get(e)}bytePairEncode(e,t){return 1===e.length?[t.getOrThrow(e)]:this.bytePairMerge(e,t,r=>{let n=e.slice(r.start,r.end);return t.getOrThrow(n)})}bytePairMerge(e,t,r){let n=Array.from({length:e.length+1},(e,t)=>({start:t,rank:Number.POSITIVE_INFINITY})),i=(r,i)=>{if(r+i+2>=n.length)return;let o=e.slice(n[r].start,n[r+i+2].start);return t.get(o)};for(let e=0;e<n.length-2;e++){let t=i(e,0);void 0!==t&&(n[e].rank=t)}for(;n.length>1;){let e=Number.POSITIVE_INFINITY,t=0,r=0;for(let i of n)i.rank<e&&(e=i.rank,t=r),r++;if(e===Number.POSITIVE_INFINITY)break;n[t].rank=i(t,1)??Number.POSITIVE_INFINITY,t>0&&(n[t-1].rank=i(t-1,1)??Number.POSITIVE_INFINITY),n.splice(t+1,1)}let o=[];for(let e=0;e<n.length-1;e++)o.push(r({start:n[e].start,end:n[e+1].start}));return o}}let d="<|endoftext|>",l="<|fim_prefix|>",h="<|fim_middle|>",p="<|fim_suffix|>",g="<|im_start|>",u="<|im_end|>",f="<|im_sep|>",b="<|endofprompt|>",m="cl100k_base",y="p50k_base",k="p50k_edit",x="r50k_base",w={"gpt-4":m,"gpt-4-32k":m,"gpt-4-0314":m,"gpt-4-32k-0314":m,"gpt-3.5-turbo":m,"gpt-3.5-turbo-0301":m,"text-davinci-003":y,"text-davinci-002":y,"text-davinci-001":x,"text-curie-001":x,"text-babbage-001":x,"text-ada-001":x,davinci:x,curie:x,babbage:x,ada:x,"code-davinci-002":y,"code-davinci-001":y,"code-cushman-002":y,"code-cushman-001":y,"davinci-codex":y,"cushman-codex":y,"text-davinci-edit-001":k,"code-davinci-edit-001":k,"text-embedding-ada-002":m,"text-similarity-davinci-001":x,"text-similarity-curie-001":x,"text-similarity-babbage-001":x,"text-similarity-ada-001":x,"text-search-davinci-doc-001":x,"text-search-curie-doc-001":x,"text-search-babbage-doc-001":x,"text-search-ada-doc-001":x,"code-search-babbage-code-001":x,"code-search-ada-code-001":x},E={"gpt-3.5-turbo":{messageSeparator:"\n",roleSeparator:"\n"},"gpt-3.5-turbo-0301":{messageSeparator:"\n",roleSeparator:"\n"},"gpt-4":{messageSeparator:"",roleSeparator:f},"gpt-4-0314":{messageSeparator:"",roleSeparator:f},"gpt-4-32k":{messageSeparator:"",roleSeparator:f},"gpt-4-32k-0314":{messageSeparator:"",roleSeparator:f}},v=/'s|'t|'re|'ve|'m|'ll|'d| ?\p{L}+| ?\p{N}+| ?[^\s\p{L}\p{N}]+|\s+(?!\S)|\s+/gu;function S(e,t){let r=t(e);switch(e.toLowerCase()){case"r50k_base":return{expectedVocabularySize:50257,tokenSplitRegex:v,mergeableBytePairRanks:r,specialTokenMapping:new Map([[d,50256]])};case"p50k_base":return{expectedVocabularySize:50281,tokenSplitRegex:v,mergeableBytePairRanks:r,specialTokenMapping:new Map([[d,50256]])};case"p50k_edit":return function(e){let t=new Map([[d,50256],[l,50281],[h,50282],[p,50283]]);return{tokenSplitRegex:v,mergeableBytePairRanks:e,specialTokenMapping:t}}(r);case"cl100k_base":return function(e){let t=new Map([[d,100257],[l,100258],[h,100259],[p,100260],[g,100264],[u,100265],[f,100266],[b,100276]]);return{tokenSplitRegex:/(?:'s|'t|'re|'ve|'m|'ll|'d)|[^\r\n\p{L}\p{N}]?\p{L}+|\p{N}{1,3}| ?[^\s\p{L}\p{N}]+[\r\n]*|\s*[\r\n]+|\s+(?!\S)|\s+/giu,mergeableBytePairRanks:e,specialTokenMapping:t}}(r);default:throw Error(`Unknown encoding name: ${e}`)}}async function T(e,t){let r=await t(e);return S(e,()=>r)}function N(e){if(0===e.length)return!1;let t=e.charCodeAt(e.length-1);return t>=55296&&t<=56319}function I(e){let t=0;return e.forEach(e=>{t=Math.max(t,e)}),t}class M{static EndOfPrompt=b;static EndOfText=d;static FimMiddle=h;static FimPrefix=l;static FimSuffix=p;decoder=new TextDecoder("utf8");modelName;bytePairEncodingCoreProcessor;specialTokenMapping;constructor({tokenSplitRegex:e,mergeableBytePairRanks:t,specialTokenMapping:r,expectedVocabularySize:n,modelName:i}){let o=Math.max(I(t),I(r));if(this.specialTokenMapping=r,void 0!==n){if(t.size+r.size!==n)throw Error("The number of mergeable tokens and special tokens must be equal to explicit_n_vocab.");if(o!==n-1)throw Error("The maximum token value must be equal to explicit_n_vocab - 1.")}this.bytePairEncodingCoreProcessor=new c({bytePairEncoder:t,specialTokenEncoder:r,tokenSplitRegex:e}),this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),this.encodeGenerator=this.encodeGenerator.bind(this),this.decodeGenerator=this.decodeGenerator.bind(this),this.decodeAsyncGenerator=this.decodeAsyncGenerator.bind(this),this.isWithinTokenLimit=this.isWithinTokenLimit.bind(this),this.modelName=i}static getEncodingApi(e,t){let r=S(e,t);return new M(r)}static getEncodingApiForModel(e,t){let r=w[e],n=S(r,t);return new M({...n,modelName:e})}static async getEncodingApiAsync(e,t){let r=await T(e,t);return new M(r)}static async getEncodingApiForModelAsync(e,t){let r=w[e],n=await T(r,t);return new M({...n,modelName:e})}encodeGenerator(e,{allowedSpecial:t=new Set,disallowedSpecial:r=new Set(["all"])}={}){let n=new Set(this.specialTokenMapping.keys());if(r.has("all")&&(r=new Set(n),t.forEach(e=>r.delete(e)),r.forEach(e=>t.delete(e))),t.has("all")&&(t=n),r.size>0){let t=function(e){let t=[...e].map(s),r=t.join("|");return RegExp(`(${r})`)}(r),n=e.match(t);if(null!==n)throw Error(`Disallowed special token found: ${n[0]}`)}return this.bytePairEncodingCoreProcessor.encodeNative(e,t)}encode(e,t={}){return[...this.encodeGenerator(e,t)].flat()}*encodeChatGenerator(e,t=this.modelName){if(!t)throw Error("Model name must be provided either during initialization or passed in to the method.");let r=E[t],n=this.specialTokenMapping.get(g),i=this.specialTokenMapping.get(u);if(!r||void 0===n||void 0===i)throw Error(`Model '${t}' does not support chat.`);let o=new Set([f]),{messageSeparator:a,roleSeparator:s}=r,c=a.length>0?this.encode(a):[],d=s.length>0?this.encode(s,{allowedSpecial:o}):[],l=new Map;for(let{role:t="system",name:r=t,content:o}of e){if(void 0===o)throw Error("Content must be defined for all messages.");yield[n];let e=l.get(r)??this.encode(r);l.set(r,e),yield e,d.length>0&&(yield d),yield*this.encodeGenerator(o),yield[i],yield c}yield[n],yield*this.encodeGenerator("assistant"),d.length>0&&(yield d)}encodeChat(e,t=this.modelName){return[...this.encodeChatGenerator(e,t)].flat()}isWithinTokenLimit(e,t){let r="string"==typeof e?this.encodeGenerator(e):this.encodeChatGenerator(e),n=0;for(let e of r)if((n+=e.length)>t)return!1;return n}*decodeGenerator(e){let t=this.bytePairEncodingCoreProcessor.decodeNative(e),r="";for(let e of t)0===(r+=this.decoder.decode(e,{stream:!0})).length||N(r)||(yield r,r="");r.length>0&&(yield r)}async*decodeAsyncGenerator(e){let t=this.bytePairEncodingCoreProcessor.decodeNativeAsync(e),r="";for await(let e of t)0===(r+=this.decoder.decode(e,{stream:!0})).length||N(r)||(yield r,r="");r.length>0&&(yield r)}decode(e){return[...this.decodeGenerator(e)].join("")}}let P=M.getEncodingApi("cl100k_base",()=>(function(e){let t=e.flatMap(([e,t])=>e&&0!==e.length?[[i.parse(e),t]]:[]);return new o(t)})(a.Z)),{decode:_,decodeAsyncGenerator:A,decodeGenerator:C,encode:G,encodeGenerator:U,isWithinTokenLimit:F,encodeChat:O,encodeChatGenerator:R}=P;var L=P}}]);